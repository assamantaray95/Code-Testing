//DRAG AND DROP MULTIPLE FILE UPLOAD START
let filesincluded = 0;
let filescompleted = 0;
let totalfiles = 0;
function formatFileSize(bytes) 
{ 
	if (typeof bytes !== "number")  
	{ 
		return "";
	}
	if (bytes >= 1000000000) 
	{
		return (bytes / 1000000000).toFixed(2) + " GB";
	} 
	if (bytes >= 1000000) 
	{
		return (bytes / 1000000).toFixed(2) + " MB";
	} 
	return (bytes / 1000).toFixed(2) + " KB";
}

$(document).ready(function (e) {
	$(document).on("click", ".upload-files-btn", function (e) {
		e.preventDefault();
		$("#dragDropFiles").find("#myfilesinput").click();
	});
	$("#myfilesinput").fileupload({
		autoUpload: true,
		dropZone: $("#myfilesinput").parents().eq(3),
		add: function (e, data) {
			let uploadBtnPointer = this;
			let fileUploaderPointer = $(uploadBtnPointer).parent().parent().parent();
			var uploadErrors = [];
			var start = 0;
			$(fileUploaderPointer).find(".fileupload-progress").removeClass("d-none");
			if ($(fileUploaderPointer).find("#dragDropFiles").find(".upl").length == 0) {
				$(fileUploaderPointer).find("#dragDropFiles").append('<div class="mt-2 upl text-success">Uploading...</div>');
			}
			if (uploadErrors.length > 0) {
				alert(uploadErrors.join("\n"));
				return false;
			} else {
				data.submit();
			}
			$(fileUploaderPointer).find(".fileupload-progress").find(".progress-bar").removeClass("bg-primary bg-danger bg-warning bg-success");
			$(fileUploaderPointer)
				.find(".progress-bar")
				.css("width", start + "%");
			filesincluded++;
			data.files[0].uploadID = "fileuploaded-" + filesincluded;
			//This area will contain file list and progress information.
			var tpl = $('<div class="working mb-3">' + '<div class="card card-body shadow-none mt-1 mb-0"></div><span></span></div>');
			// Append the file name and file size
			tpl.find("div").append(
				'<div class="fileupload-indiviual-file-info d-flex align-items-center"><span>File name: ' +
					data.files[0].name +
					'</span><span class="ms-auto">File size: ' +
					formatFileSize(data.files[0].size) +
					'</span></div><div class="progress progressbardiv-' +
					data.files[0].uploadID +
					'"><div class="progress-bar progress-bar-striped bg-success progress-bar-animated" style="border-radius: 0" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div></div>'
			);
			// Add the HTML to the UL element
			data.context = tpl.appendTo($("#fileList"));
			// Automatically upload the file once it is added to the queue
			var jqXHR = data.submit();
			totalfiles++;
			
		},
		progress: function (e, data) {
			let uploadBtnPointer = this;
			let fileUploaderPointer = $(uploadBtnPointer).parent().parent().parent();
			var progress = parseInt((data.loaded / data.total) * 100, 10);
			$(fileUploaderPointer).find(".fileupload-progress").addClass("show");
			$(fileUploaderPointer)
				.find(".progressbardiv-" + data.files[0].uploadID)
				.find(".progress-bar")
				.css("width", progress + "%");
			if (progress <= 25) {
				$(fileUploaderPointer)
					.find(".progressbardiv-" + data.files[0].uploadID)
					.find(".progress-bar")
					.removeClass("bg-success")
					.addClass("bg-danger");
			} else if (progress <= 50) {
				$(fileUploaderPointer)
					.find(".progressbardiv-" + data.files[0].uploadID)
					.find(".progress-bar")
					.removeClass("bg-success bg-danger")
					.addClass("bg-warning");
			} else if (progress <= 75) {
				$(fileUploaderPointer)
					.find(".progressbardiv-" + data.files[0].uploadID)
					.find(".progress-bar")
					.removeClass("bg-success bg-danger bg-warning")
					.addClass("bg-primary");
			} else if (progress <= 100) {
				$(fileUploaderPointer)
					.find(".progressbardiv-" + data.files[0].uploadID)
					.find(".progress-bar")
					.removeClass("bg-primary bg-danger bg-warning")
					.addClass("bg-success");
			}
			$(fileUploaderPointer)
				.find(".upl")
				.html("Uploading... (" + progress + ")%");
				// location.reload();
			},
		done: function (e, data) {
			
			let filesUploadedIdsArray = [];
			let filesUploadedIDString = "";
			let uploadBtnPointer = this;
			let fileUploaderPointer = $(uploadBtnPointer).parent().parent().parent();
			let oldFiles = $(fileUploaderPointer).find("#d_file_list").val();
			var jsonData = data.result;
			filescompleted++;
			
			if (totalfiles == filescompleted) {
				$(fileUploaderPointer).find(".upl").html('<i class="fas fa-check-circle me-1"></i> Selected files have been uploaded.');
				$(fileUploaderPointer).find(".fileupload-progress").removeClass("show");
				$(fileUploaderPointer).find(".progress").addClass("d-none");
			}
			$(fileUploaderPointer).find('.progressbardiv-' + data.files[0].uploadID).find(".progress-bar").css(
				"width",
				"0%"
			);
			filesUploadedIdsArray.push(jsonData.filepath);console.log(jsonData);console.log(jsonData.filepath);
			filesUploadedIDString = filesUploadedIdsArray.join();
			var filteredCommaDelimatedString = "";

			if (oldFiles != "") {
				filteredCommaDelimatedString = (oldFiles + "," + filesUploadedIDString).split(",").filter(function (item, pos, self) {
					return self.indexOf(item) == pos;
				});
				$(fileUploaderPointer).find("#d_file_list").val(filteredCommaDelimatedString);
			} else {
				filteredCommaDelimatedString = (filesUploadedIDString).split(",").filter(function (item, pos, self) {
					return self.indexOf(item) == pos;
				});
				$(fileUploaderPointer).find("#d_file_list").val(filteredCommaDelimatedString);
			}
			//  alert("ok");
		},
		maxPostSize: 1000000000,
		maxFileSize: 1000000000,
		maxChunkSize: 0,
	});
});
//DRAG AND DROP MULTIPLE FILE UPLOAD END


//Drag and Drop HTML
<div class="col-lg-12">
	<div class="form-group mb-4">
		<label class="form-label">Upload Miscellaneous</label>
		<div class="text-center">
			<div id="dragDropFiles">
				<div id="fileuploader">
					<input type="hidden" name="consumerid" id="consumerid" value="<?php print $iPersonnelID; ?>">
					<input type="hidden" name="d_file_list" id="d_file_list" value="" class="form-control">
					<input type="file" class="d-none" name="myfilesinput" id="myfilesinput" data-url="<?php echo $APP->BASEURL; ?>/nc/personnel/index.php?ID=251" tabindex="<?php print $iTabIndex++;?>" multiple/>
					<div id="fileuploader">
						<div class="ajax-upload-dragdrop d-flex align-items-center justify-content-center" style="width: 400px;">
							<div class="text-center">
								<img src="<?php print $APP->BASEURL;?>/pub/images/cloud-upload.png" style="width: 64px;"/>
								<h6 class="mb-1 fw-normal">Drag and drop</h6>
							<div class="text-muted" style="font-size: 14px;">
							or
						</div>
						<button class="btn btn-info btn-lg mt-1 upload-files-btn">
							Upload Files
						</button>
					</div>
				</div>
				<div id="onFileDragDiv" class="d-none">
					<h4>Drop Files Here</h4>
				</div>
			</div>
		</div>
	</div>
	<div class="fileupload-progress mt-2"> 
		<div id="fileList">
			<!-- The file list will be shown here -->
		</div>
	</div>
</div>


//uploadfile.min.css
.ajax-file-upload-statusbar{border:1px solid #0ba1b5;margin-top:10px;width:420px;margin-right:10px;margin:5px;-moz-border-radius:4px;-webkit-border-radius:4px;border-radius:4px;padding:5px 5px 5px 15px}.ajax-file-upload-filename{width:300px;height:auto;margin:0 5px 5px 0}.ajax-file-upload-filesize{width:50px;height:auto;margin:0 5px 5px 0;display:inline-block;vertical-align:middle}.ajax-file-upload-progress{margin:5px 10px 5px 0;position:relative;width:250px;border:1px solid #ddd;padding:1px;border-radius:3px;display:inline-block;color:#fff}.ajax-file-upload-bar{background-color:#0ba1b5;width:0;height:20px;border-radius:3px;color:#fff}.ajax-file-upload-percent{position:absolute;display:inline-block;top:3px;left:48%}.ajax-file-upload-red{-moz-box-shadow:inset 0 39px 0 -24px #e67a73;-webkit-box-shadow:inset 0 39px 0 -24px #e67a73;box-shadow:inset 0 39px 0 -24px #e67a73;background-color:#e4685d;-moz-border-radius:4px;-webkit-border-radius:4px;border-radius:4px;display:inline-block;color:#fff;font-family:arial;font-size:13px;font-weight:400;padding:4px 15px;text-decoration:none;text-shadow:0 1px 0 #b23e35;cursor:pointer;vertical-align:top;margin:5px 10px 5px 0}.ajax-file-upload-green{background-color:#77b55a;-moz-border-radius:4px;-webkit-border-radius:4px;border-radius:4px;margin:0;padding:0;display:inline-block;color:#fff;font-family:arial;font-size:13px;font-weight:400;padding:4px 15px;text-decoration:none;cursor:pointer;text-shadow:0 1px 0 #5b8a3c;vertical-align:top;margin:5px 10px 5px 0}.ajax-file-upload{font-family:Arial,Helvetica,sans-serif;font-size:16px;font-weight:700;padding:15px 20px;cursor:pointer;line-height:20px;height:25px;margin:0 10px 10px 0;display:inline-block;background:#fff;border:1px solid #e8e8e8;color:#888;text-decoration:none;border-radius:3px;-webkit-border-radius:3px;-moz-border-radius:3px;-moz-box-shadow:0 2px 0 0 #e8e8e8;-webkit-box-shadow:0 2px 0 0 #e8e8e8;box-shadow:0 2px 0 0 #e8e8e8;padding:6px 10px 4px 10px;color:#fff;background:#2f8ab9;border:none;-moz-box-shadow:0 2px 0 0 #13648d;-webkit-box-shadow:0 2px 0 0 #13648d;box-shadow:0 2px 0 0 #13648d;vertical-align:middle}.ajax-file-upload:hover{background:#3396c9;-moz-box-shadow:0 2px 0 0 #15719f;-webkit-box-shadow:0 2px 0 0 #15719f;box-shadow:0 2px 0 0 #15719f}.ajax-upload-dragdrop{border:2px dotted #a5a5c7;color:#dadce3;text-align:left;vertical-align:middle;padding:10px 10px 0 10px}.state-hover{border:2px solid #a5a5c7}.ajax-file-upload-container{margin:20px 0 20px 0}
//jquery.fileupload.min.css
@charset "UTF-8";.fileinput-button{position:relative;overflow:hidden;display:inline-block}.fileinput-button input{position:absolute;top:0;right:0;margin:0;height:100%;opacity:0;font-size:200px!important;direction:ltr;cursor:pointer}@media screen\9{.fileinput-button input{font-size:150%!important}}
//jquery.fileupload-ui.min.css
@charset "UTF-8";.progress-animated .bar,.progress-animated .progress-bar{background:url(../img/progressbar.gif)!important;filter:none}.fileupload-process{float:right;display:none}.files .processing .preview,.fileupload-processing .fileupload-process{display:block;width:32px;height:32px;background:url(../img/loading.gif) center no-repeat;background-size:contain}.files audio,.files video{max-width:300px}.files .name{word-wrap:break-word;overflow-wrap:anywhere;-webkit-hyphens:auto;hyphens:auto}.files button{margin-bottom:5px}.toggle[type=checkbox]{transform:scale(2);margin-left:10px}@media (max-width:767px){.fileupload-buttonbar .btn{margin-bottom:5px}.files .btn span,.files .toggle,.fileupload-buttonbar .delete,.fileupload-buttonbar .toggle{display:none}.files audio,.files video{max-width:80px}}@media (max-width:480px){.files .image td:nth-child(2){display:none}}
//jquery.iframe-transport.min.js
!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports?e(require("jquery")):e(window.jQuery)}(function(f){"use strict";var n=0,t=f,r="parseJSON";"JSON"in window&&"parse"in JSON&&(t=JSON,r="parse"),f.ajaxTransport("iframe",function(a){if(a.async){var o,i,t,p=a.initialIframeSrc||"javascript:false;";return{send:function(e,r){(o=f('<form style="display:none;"></form>')).attr("accept-charset",a.formAcceptCharset),t=/\?/.test(a.url)?"&":"?","DELETE"===a.type?(a.url=a.url+t+"_method=DELETE",a.type="POST"):"PUT"===a.type?(a.url=a.url+t+"_method=PUT",a.type="POST"):"PATCH"===a.type&&(a.url=a.url+t+"_method=PATCH",a.type="POST"),i=f('<iframe src="'+p+'" name="iframe-transport-'+(n+=1)+'"></iframe>').on("load",function(){var n,t=f.isArray(a.paramName)?a.paramName:[a.paramName];i.off("load").on("load",function(){var t;try{if(!(t=i.contents()).length||!t[0].firstChild)throw new Error}catch(e){t=void 0}r(200,"success",{iframe:t}),f('<iframe src="'+p+'"></iframe>').appendTo(o),window.setTimeout(function(){o.remove()},0)}),o.prop("target",i.prop("name")).prop("action",a.url).prop("method",a.type),a.formData&&f.each(a.formData,function(e,t){f('<input type="hidden"/>').prop("name",t.name).val(t.value).appendTo(o)}),a.fileInput&&a.fileInput.length&&"POST"===a.type&&(n=a.fileInput.clone(),a.fileInput.after(function(e){return n[e]}),a.paramName&&a.fileInput.each(function(e){f(this).prop("name",t[e]||a.paramName)}),o.append(a.fileInput).prop("enctype","multipart/form-data").prop("encoding","multipart/form-data"),a.fileInput.removeAttr("form")),window.setTimeout(function(){o.submit(),n&&n.length&&a.fileInput.each(function(e,t){var r=f(n[e]);f(t).prop("name",r.prop("name")).attr("form",r.attr("form")),r.replaceWith(t)})},0)}),o.append(i).appendTo(document.body)},abort:function(){i&&i.off("load").prop("src",p),o&&o.remove()}}}}),f.ajaxSetup({converters:{"iframe text":function(e){return e&&f(e[0].body).text()},"iframe json":function(e){return e&&t[r](f(e[0].body).text())},"iframe html":function(e){return e&&f(e[0].body).html()},"iframe xml":function(e){var t=e&&e[0];return t&&f.isXMLDoc(t)?t:f.parseXML(t.XMLDocument&&t.XMLDocument.xml||f(t.body).html())},"iframe script":function(e){return e&&f.globalEval(f(e[0].body).text())}}})});
//jquery.fileupload.min.js
!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","jquery-ui/ui/widget"],e):"object"==typeof exports?e(require("jquery"),require("./vendor/jquery.ui.widget")):e(window.jQuery)}(function(m){"use strict";function e(i){var r="dragover"===i;return function(e){e.dataTransfer=e.originalEvent&&e.originalEvent.dataTransfer;var t=e.dataTransfer;t&&-1!==m.inArray("Files",t.types)&&!1!==this._trigger(i,m.Event(i,{delegatedEvent:e}))&&(e.preventDefault(),r&&(t.dropEffect="copy"))}}var t;m.support.fileInput=!(new RegExp("(Android (1\\.[0156]|2\\.[01]))|(Windows Phone (OS 7|8\\.0))|(XBLWP)|(ZuneWP)|(WPDesktop)|(w(eb)?OSBrowser)|(webOS)|(Kindle/(1\\.0|2\\.[05]|3\\.0))").test(window.navigator.userAgent)||m('<input type="file"/>').prop("disabled")),m.support.xhrFileUpload=!(!window.ProgressEvent||!window.FileReader),m.support.xhrFormDataFileUpload=!!window.FormData,m.support.blobSlice=window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice),m.widget("blueimp.fileupload",{options:{dropZone:m(document),pasteZone:void 0,fileInput:void 0,replaceFileInput:!0,paramName:void 0,singleFileUploads:!0,limitMultiFileUploads:void 0,limitMultiFileUploadSize:void 0,limitMultiFileUploadSizeOverhead:512,sequentialUploads:!1,limitConcurrentUploads:void 0,forceIframeTransport:!1,redirect:void 0,redirectParamName:void 0,postMessage:void 0,multipart:!0,maxChunkSize:void 0,uploadedBytes:void 0,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,autoUpload:!0,uniqueFilenames:void 0,messages:{uploadedBytes:"Uploaded bytes exceed file size"},i18n:function(i,e){return i=this.messages[i]||i.toString(),e&&m.each(e,function(e,t){i=i.replace("{"+e+"}",t)}),i},formData:function(e){return e.serializeArray()},add:function(e,t){if(e.isDefaultPrevented())return!1;(t.autoUpload||!1!==t.autoUpload&&m(this).fileupload("option","autoUpload"))&&t.process().done(function(){t.submit()})},processData:!1,contentType:!1,cache:!1,timeout:0},_promisePipe:(t=m.fn.jquery.split("."),1<Number(t[0])||7<Number(t[1])?"then":"pipe"),_specialOptions:["fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_blobSlice:m.support.blobSlice&&function(){return(this.slice||this.webkitSlice||this.mozSlice).apply(this,arguments)},_BitrateTimer:function(){this.timestamp=Date.now?Date.now():(new Date).getTime(),this.loaded=0,this.bitrate=0,this.getBitrate=function(e,t,i){var r=e-this.timestamp;return this.bitrate&&i&&!(i<r)||(this.bitrate=(t-this.loaded)*(1e3/r)*8,this.loaded=t,this.timestamp=e),this.bitrate}},_isXHRUpload:function(e){return!e.forceIframeTransport&&(!e.multipart&&m.support.xhrFileUpload||m.support.xhrFormDataFileUpload)},_getFormData:function(e){var i;return"function"===m.type(e.formData)?e.formData(e.form):m.isArray(e.formData)?e.formData:"object"===m.type(e.formData)?(i=[],m.each(e.formData,function(e,t){i.push({name:e,value:t})}),i):[]},_getTotal:function(e){var i=0;return m.each(e,function(e,t){i+=t.size||1}),i},_initProgressObject:function(e){var t={loaded:0,total:0,bitrate:0};e._progress?m.extend(e._progress,t):e._progress=t},_initResponseObject:function(e){var t;if(e._response)for(t in e._response)Object.prototype.hasOwnProperty.call(e._response,t)&&delete e._response[t];else e._response={}},_onProgress:function(e,t){if(e.lengthComputable){var i,r=Date.now?Date.now():(new Date).getTime();if(t._time&&t.progressInterval&&r-t._time<t.progressInterval&&e.loaded!==e.total)return;t._time=r,i=Math.floor(e.loaded/e.total*(t.chunkSize||t._progress.total))+(t.uploadedBytes||0),this._progress.loaded+=i-t._progress.loaded,this._progress.bitrate=this._bitrateTimer.getBitrate(r,this._progress.loaded,t.bitrateInterval),t._progress.loaded=t.loaded=i,t._progress.bitrate=t.bitrate=t._bitrateTimer.getBitrate(r,i,t.bitrateInterval),this._trigger("progress",m.Event("progress",{delegatedEvent:e}),t),this._trigger("progressall",m.Event("progressall",{delegatedEvent:e}),this._progress)}},_initProgressListener:function(i){var r=this,e=i.xhr?i.xhr():m.ajaxSettings.xhr();e.upload&&(m(e.upload).on("progress",function(e){var t=e.originalEvent;e.lengthComputable=t.lengthComputable,e.loaded=t.loaded,e.total=t.total,r._onProgress(e,i)}),i.xhr=function(){return e})},_deinitProgressListener:function(e){var t=e.xhr?e.xhr():m.ajaxSettings.xhr();t.upload&&m(t.upload).off("progress")},_isInstanceOf:function(e,t){return Object.prototype.toString.call(t)==="[object "+e+"]"},_getUniqueFilename:function(e,t){return t[e=String(e)]?(e=e.replace(/(?: \(([\d]+)\))?(\.[^.]+)?$/,function(e,t,i){return" ("+(t?Number(t)+1:1)+")"+(i||"")}),this._getUniqueFilename(e,t)):(t[e]=!0,e)},_initXHRData:function(r){var n,o=this,e=r.files[0],t=r.multipart||!m.support.xhrFileUpload,s="array"===m.type(r.paramName)?r.paramName[0]:r.paramName;r.headers=m.extend({},r.headers),r.contentRange&&(r.headers["Content-Range"]=r.contentRange),t&&!r.blob&&this._isInstanceOf("File",e)||(r.headers["Content-Disposition"]='attachment; filename="'+encodeURI(e.uploadName||e.name)+'"'),t?m.support.xhrFormDataFileUpload&&(r.postMessage?(n=this._getFormData(r),r.blob?n.push({name:s,value:r.blob}):m.each(r.files,function(e,t){n.push({name:"array"===m.type(r.paramName)&&r.paramName[e]||s,value:t})})):(o._isInstanceOf("FormData",r.formData)?n=r.formData:(n=new FormData,m.each(this._getFormData(r),function(e,t){n.append(t.name,t.value)})),r.blob?n.append(s,r.blob,e.uploadName||e.name):m.each(r.files,function(e,t){var i;(o._isInstanceOf("File",t)||o._isInstanceOf("Blob",t))&&(i=t.uploadName||t.name,r.uniqueFilenames&&(i=o._getUniqueFilename(i,r.uniqueFilenames)),n.append("array"===m.type(r.paramName)&&r.paramName[e]||s,t,i))})),r.data=n):(r.contentType=e.type||"application/octet-stream",r.data=r.blob||e),r.blob=null},_initIframeSettings:function(e){var t=m("<a></a>").prop("href",e.url).prop("host");e.dataType="iframe "+(e.dataType||""),e.formData=this._getFormData(e),e.redirect&&t&&t!==location.host&&e.formData.push({name:e.redirectParamName||"redirect",value:e.redirect})},_initDataSettings:function(e){this._isXHRUpload(e)?(this._chunkedUpload(e,!0)||(e.data||this._initXHRData(e),this._initProgressListener(e)),e.postMessage&&(e.dataType="postmessage "+(e.dataType||""))):this._initIframeSettings(e)},_getParamName:function(e){var t=m(e.fileInput),r=e.paramName;return r?m.isArray(r)||(r=[r]):(r=[],t.each(function(){for(var e=m(this),t=e.prop("name")||"files[]",i=(e.prop("files")||[1]).length;i;)r.push(t),--i}),r.length||(r=[t.prop("name")||"files[]"])),r},_initFormSettings:function(e){e.form&&e.form.length||(e.form=m(e.fileInput.prop("form")),e.form.length||(e.form=m(this.options.fileInput.prop("form")))),e.paramName=this._getParamName(e),e.url||(e.url=e.form.prop("action")||location.href),e.type=(e.type||"string"===m.type(e.form.prop("method"))&&e.form.prop("method")||"").toUpperCase(),"POST"!==e.type&&"PUT"!==e.type&&"PATCH"!==e.type&&(e.type="POST"),e.formAcceptCharset||(e.formAcceptCharset=e.form.attr("accept-charset"))},_getAJAXSettings:function(e){var t=m.extend({},this.options,e);return this._initFormSettings(t),this._initDataSettings(t),t},_getDeferredState:function(e){return e.state?e.state():e.isResolved()?"resolved":e.isRejected()?"rejected":"pending"},_enhancePromise:function(e){return e.success=e.done,e.error=e.fail,e.complete=e.always,e},_getXHRPromise:function(e,t,i){var r=m.Deferred(),n=r.promise();return t=t||this.options.context||n,!0===e?r.resolveWith(t,i):!1===e&&r.rejectWith(t,i),n.abort=r.promise,this._enhancePromise(n)},_addConvenienceMethods:function(e,i){function r(e){return m.Deferred().resolveWith(n,e).promise()}var n=this;i.process=function(e,t){return(e||t)&&(i._processQueue=this._processQueue=(this._processQueue||r([this]))[n._promisePipe](function(){return i.errorThrown?m.Deferred().rejectWith(n,[i]).promise():r(arguments)})[n._promisePipe](e,t)),this._processQueue||r([this])},i.submit=function(){return"pending"!==this.state()&&(i.jqXHR=this.jqXHR=!1!==n._trigger("submit",m.Event("submit",{delegatedEvent:e}),this)&&n._onSend(e,this)),this.jqXHR||n._getXHRPromise()},i.abort=function(){return this.jqXHR?this.jqXHR.abort():(this.errorThrown="abort",n._trigger("fail",null,this),n._getXHRPromise(!1))},i.state=function(){return this.jqXHR?n._getDeferredState(this.jqXHR):this._processQueue?n._getDeferredState(this._processQueue):void 0},i.processing=function(){return!this.jqXHR&&this._processQueue&&"pending"===n._getDeferredState(this._processQueue)},i.progress=function(){return this._progress},i.response=function(){return this._response}},_getUploadedBytes:function(e){var t=e.getResponseHeader("Range"),i=t&&t.split("-"),r=i&&1<i.length&&parseInt(i[1],10);return r&&r+1},_chunkedUpload:function(o,e){o.uploadedBytes=o.uploadedBytes||0;var t,s,a=this,i=o.files[0],l=i.size,p=o.uploadedBytes,u=o.maxChunkSize||l,d=this._blobSlice,h=m.Deferred(),r=h.promise();return!(!(this._isXHRUpload(o)&&d&&(p||("function"===m.type(u)?u(o):u)<l))||o.data)&&(!!e||(l<=p?(i.error=o.i18n("uploadedBytes"),this._getXHRPromise(!1,o.context,[null,"error",i.error])):(s=function(){var r=m.extend({},o),n=r._progress.loaded;r.blob=d.call(i,p,p+("function"===m.type(u)?u(r):u),i.type),r.chunkSize=r.blob.size,r.contentRange="bytes "+p+"-"+(p+r.chunkSize-1)+"/"+l,a._trigger("chunkbeforesend",null,r),a._initXHRData(r),a._initProgressListener(r),t=(!1!==a._trigger("chunksend",null,r)&&m.ajax(r)||a._getXHRPromise(!1,r.context)).done(function(e,t,i){p=a._getUploadedBytes(i)||p+r.chunkSize,n+r.chunkSize-r._progress.loaded&&a._onProgress(m.Event("progress",{lengthComputable:!0,loaded:p-r.uploadedBytes,total:p-r.uploadedBytes}),r),o.uploadedBytes=r.uploadedBytes=p,r.result=e,r.textStatus=t,r.jqXHR=i,a._trigger("chunkdone",null,r),a._trigger("chunkalways",null,r),p<l?s():h.resolveWith(r.context,[e,t,i])}).fail(function(e,t,i){r.jqXHR=e,r.textStatus=t,r.errorThrown=i,a._trigger("chunkfail",null,r),a._trigger("chunkalways",null,r),h.rejectWith(r.context,[e,t,i])}).always(function(){a._deinitProgressListener(r)})},this._enhancePromise(r),r.abort=function(){return t.abort()},s(),r)))},_beforeSend:function(e,t){0===this._active&&(this._trigger("start"),this._bitrateTimer=new this._BitrateTimer,this._progress.loaded=this._progress.total=0,this._progress.bitrate=0),this._initResponseObject(t),this._initProgressObject(t),t._progress.loaded=t.loaded=t.uploadedBytes||0,t._progress.total=t.total=this._getTotal(t.files)||1,t._progress.bitrate=t.bitrate=0,this._active+=1,this._progress.loaded+=t.loaded,this._progress.total+=t.total},_onDone:function(e,t,i,r){var n=r._progress.total,o=r._response;r._progress.loaded<n&&this._onProgress(m.Event("progress",{lengthComputable:!0,loaded:n,total:n}),r),o.result=r.result=e,o.textStatus=r.textStatus=t,o.jqXHR=r.jqXHR=i,this._trigger("done",null,r)},_onFail:function(e,t,i,r){var n=r._response;r.recalculateProgress&&(this._progress.loaded-=r._progress.loaded,this._progress.total-=r._progress.total),n.jqXHR=r.jqXHR=e,n.textStatus=r.textStatus=t,n.errorThrown=r.errorThrown=i,this._trigger("fail",null,r)},_onAlways:function(e,t,i,r){this._trigger("always",null,r)},_onSend:function(e,t){t.submit||this._addConvenienceMethods(e,t);function i(){return a._sending+=1,l._bitrateTimer=new a._BitrateTimer,r=r||((n||!1===a._trigger("send",m.Event("send",{delegatedEvent:e}),l))&&a._getXHRPromise(!1,l.context,n)||a._chunkedUpload(l)||m.ajax(l)).done(function(e,t,i){a._onDone(e,t,i,l)}).fail(function(e,t,i){a._onFail(e,t,i,l)}).always(function(e,t,i){if(a._deinitProgressListener(l),a._onAlways(e,t,i,l),--a._sending,--a._active,l.limitConcurrentUploads&&l.limitConcurrentUploads>a._sending)for(var r=a._slots.shift();r;){if("pending"===a._getDeferredState(r)){r.resolve();break}r=a._slots.shift()}0===a._active&&a._trigger("stop")})}var r,n,o,s,a=this,l=a._getAJAXSettings(t);return this._beforeSend(e,l),this.options.sequentialUploads||this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending?((s=1<this.options.limitConcurrentUploads?(o=m.Deferred(),this._slots.push(o),o[a._promisePipe](i)):(this._sequence=this._sequence[a._promisePipe](i,i),this._sequence)).abort=function(){return n=[void 0,"abort","abort"],r?r.abort():(o&&o.rejectWith(l.context,n),i())},this._enhancePromise(s)):i()},_onAdd:function(r,n){var o,e,s,t,a=this,l=!0,i=m.extend({},this.options,n),p=n.files,u=p.length,d=i.limitMultiFileUploads,h=i.limitMultiFileUploadSize,c=i.limitMultiFileUploadSizeOverhead,f=0,g=this._getParamName(i),_=0;if(!u)return!1;if(h&&void 0===p[0].size&&(h=void 0),(i.singleFileUploads||d||h)&&this._isXHRUpload(i))if(i.singleFileUploads||h||!d)if(!i.singleFileUploads&&h)for(s=[],o=[],t=0;t<u;t+=1)f+=p[t].size+c,(t+1===u||f+p[t+1].size+c>h||d&&d<=t+1-_)&&(s.push(p.slice(_,t+1)),(e=g.slice(_,t+1)).length||(e=g),o.push(e),_=t+1,f=0);else o=g;else for(s=[],o=[],t=0;t<u;t+=d)s.push(p.slice(t,t+d)),(e=g.slice(t,t+d)).length||(e=g),o.push(e);else s=[p],o=[g];return n.originalFiles=p,m.each(s||p,function(e,t){var i=m.extend({},n);return i.files=s?t:[t],i.paramName=o[e],a._initResponseObject(i),a._initProgressObject(i),a._addConvenienceMethods(r,i),l=a._trigger("add",m.Event("add",{delegatedEvent:r}),i)}),l},_replaceFileInput:function(e){var i=e.fileInput,r=i.clone(!0),t=i.is(document.activeElement);e.fileInputClone=r,m("<form></form>").append(r)[0].reset(),i.after(r).detach(),t&&r.trigger("focus"),m.cleanData(i.off("remove")),this.options.fileInput=this.options.fileInput.map(function(e,t){return t===i[0]?r[0]:t}),i[0]===this.element[0]&&(this.element=r)},_handleFileTreeEntry:function(i,r){function n(e){e&&!e.entry&&(e.entry=i),s.resolve([e])}var e,o=this,s=m.Deferred(),a=[],l=function(){e.readEntries(function(e){var t;e.length?(a=a.concat(e),l()):(t=a,o._handleFileTreeEntries(t,r+i.name+"/").done(function(e){s.resolve(e)}).fail(n))},n)};return r=r||"",i.isFile?i._file?(i._file.relativePath=r,s.resolve(i._file)):i.file(function(e){e.relativePath=r,s.resolve(e)},n):i.isDirectory?(e=i.createReader(),l()):s.resolve([]),s.promise()},_handleFileTreeEntries:function(e,t){var i=this;return m.when.apply(m,m.map(e,function(e){return i._handleFileTreeEntry(e,t)}))[this._promisePipe](function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(e){var t=(e=e||{}).items;return t&&t.length&&(t[0].webkitGetAsEntry||t[0].getAsEntry)?this._handleFileTreeEntries(m.map(t,function(e){var t;return e.webkitGetAsEntry?((t=e.webkitGetAsEntry())&&(t._file=e.getAsFile()),t):e.getAsEntry()})):m.Deferred().resolve(m.makeArray(e.files)).promise()},_getSingleFileInputFiles:function(e){var t,i,r=(e=m(e)).prop("webkitEntries")||e.prop("entries");if(r&&r.length)return this._handleFileTreeEntries(r);if((t=m.makeArray(e.prop("files"))).length)void 0===t[0].name&&t[0].fileName&&m.each(t,function(e,t){t.name=t.fileName,t.size=t.fileSize});else{if(!(i=e.prop("value")))return m.Deferred().resolve([]).promise();t=[{name:i.replace(/^.*\\/,"")}]}return m.Deferred().resolve(t).promise()},_getFileInputFiles:function(e){return e instanceof m&&1!==e.length?m.when.apply(m,m.map(e,this._getSingleFileInputFiles))[this._promisePipe](function(){return Array.prototype.concat.apply([],arguments)}):this._getSingleFileInputFiles(e)},_onChange:function(t){var i=this,r={fileInput:m(t.target),form:m(t.target.form)};this._getFileInputFiles(r.fileInput).always(function(e){r.files=e,i.options.replaceFileInput&&i._replaceFileInput(r),!1!==i._trigger("change",m.Event("change",{delegatedEvent:t}),r)&&i._onAdd(t,r)})},_onPaste:function(e){var t=e.originalEvent&&e.originalEvent.clipboardData&&e.originalEvent.clipboardData.items,r={files:[]};t&&t.length&&(m.each(t,function(e,t){var i=t.getAsFile&&t.getAsFile();i&&r.files.push(i)}),!1!==this._trigger("paste",m.Event("paste",{delegatedEvent:e}),r)&&this._onAdd(e,r))},_onDrop:function(t){t.dataTransfer=t.originalEvent&&t.originalEvent.dataTransfer;var i=this,e=t.dataTransfer,r={};e&&e.files&&e.files.length&&(t.preventDefault(),this._getDroppedFiles(e).always(function(e){r.files=e,!1!==i._trigger("drop",m.Event("drop",{delegatedEvent:t}),r)&&i._onAdd(t,r)}))},_onDragOver:e("dragover"),_onDragEnter:e("dragenter"),_onDragLeave:e("dragleave"),_initEventHandlers:function(){this._isXHRUpload(this.options)&&(this._on(this.options.dropZone,{dragover:this._onDragOver,drop:this._onDrop,dragenter:this._onDragEnter,dragleave:this._onDragLeave}),this._on(this.options.pasteZone,{paste:this._onPaste})),m.support.fileInput&&this._on(this.options.fileInput,{change:this._onChange})},_destroyEventHandlers:function(){this._off(this.options.dropZone,"dragenter dragleave dragover drop"),this._off(this.options.pasteZone,"paste"),this._off(this.options.fileInput,"change")},_destroy:function(){this._destroyEventHandlers()},_setOption:function(e,t){var i=-1!==m.inArray(e,this._specialOptions);i&&this._destroyEventHandlers(),this._super(e,t),i&&(this._initSpecialOptions(),this._initEventHandlers())},_initSpecialOptions:function(){var e=this.options;void 0===e.fileInput?e.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]'):e.fileInput instanceof m||(e.fileInput=m(e.fileInput)),e.dropZone instanceof m||(e.dropZone=m(e.dropZone)),e.pasteZone instanceof m||(e.pasteZone=m(e.pasteZone))},_getRegExp:function(e){var t=e.split("/"),i=t.pop();return t.shift(),new RegExp(t.join("/"),i)},_isRegExpOption:function(e,t){return"url"!==e&&"string"===m.type(t)&&/^\/.*\/[igm]{0,3}$/.test(t)},_initDataAttributes:function(){var n=this,o=this.options,s=this.element.data();m.each(this.element[0].attributes,function(e,t){var i,r=t.name.toLowerCase();/^data-/.test(r)&&(r=r.slice(5).replace(/-[a-z]/g,function(e){return e.charAt(1).toUpperCase()}),i=s[r],n._isRegExpOption(r,i)&&(i=n._getRegExp(i)),o[r]=i)})},_create:function(){this._initDataAttributes(),this._initSpecialOptions(),this._slots=[],this._sequence=this._getXHRPromise(!0),this._sending=this._active=0,this._initProgressObject(this),this._initEventHandlers()},active:function(){return this._active},progress:function(){return this._progress},add:function(t){var i=this;t&&!this.options.disabled&&(t.fileInput&&!t.files?this._getFileInputFiles(t.fileInput).always(function(e){t.files=e,i._onAdd(null,t)}):(t.files=m.makeArray(t.files),this._onAdd(null,t)))},send:function(t){if(t&&!this.options.disabled){if(t.fileInput&&!t.files){var i,r,n=this,o=m.Deferred(),e=o.promise();return e.abort=function(){return r=!0,i?i.abort():(o.reject(null,"abort","abort"),e)},this._getFileInputFiles(t.fileInput).always(function(e){r||(e.length?(t.files=e,(i=n._onSend(null,t)).then(function(e,t,i){o.resolve(e,t,i)},function(e,t,i){o.reject(e,t,i)})):o.reject())}),this._enhancePromise(e)}if(t.files=m.makeArray(t.files),t.files.length)return this._onSend(null,t)}return this._getXHRPromise(!1,t&&t.context)}})});
//jquery.fileupload-ui.min.js
!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","blueimp-tmpl","./jquery.fileupload-image","./jquery.fileupload-audio","./jquery.fileupload-video","./jquery.fileupload-validate"],e):"object"==typeof exports?e(require("jquery"),require("blueimp-tmpl"),require("./jquery.fileupload-image"),require("./jquery.fileupload-audio"),require("./jquery.fileupload-video"),require("./jquery.fileupload-validate")):e(window.jQuery,window.tmpl)}(function(d,t){"use strict";d.blueimp.fileupload.prototype._specialOptions.push("filesContainer","uploadTemplateId","downloadTemplateId"),d.widget("blueimp.fileupload",d.blueimp.fileupload,{options:{autoUpload:!1,showElementClass:"in",uploadTemplateId:"template-upload",downloadTemplateId:"template-download",filesContainer:void 0,prependFiles:!1,dataType:"json",messages:{unknownError:"Unknown error"},getNumberOfFiles:function(){return this.filesContainer.children().not(".processing").length},getFilesFromResponse:function(e){return e.result&&d.isArray(e.result.files)?e.result.files:[]},add:function(e,i){if(e.isDefaultPrevented())return!1;var t=d(this),n=t.data("blueimp-fileupload")||t.data("fileupload"),r=n.options;i.context=n._renderUpload(i.files).data("data",i).addClass("processing"),r.filesContainer[r.prependFiles?"prepend":"append"](i.context),n._forceReflow(i.context),n._transition(i.context),i.process(function(){return t.fileupload("process",i)}).always(function(){i.context.each(function(e){d(this).find(".size").text(n._formatFileSize(i.files[e].size))}).removeClass("processing"),n._renderPreviews(i)}).done(function(){i.context.find(".edit,.start").prop("disabled",!1),!1!==n._trigger("added",e,i)&&(r.autoUpload||i.autoUpload)&&!1!==i.autoUpload&&i.submit()}).fail(function(){i.files.error&&i.context.each(function(e){var t=i.files[e].error;t&&d(this).find(".error").text(t)})})},send:function(e,t){if(e.isDefaultPrevented())return!1;var i=d(this).data("blueimp-fileupload")||d(this).data("fileupload");return t.context&&t.dataType&&"iframe"===t.dataType.substr(0,6)&&t.context.find(".progress").addClass(!d.support.transition&&"progress-animated").attr("aria-valuenow",100).children().first().css("width","100%"),i._trigger("sent",e,t)},done:function(i,n){if(i.isDefaultPrevented())return!1;var r,o,a=d(this).data("blueimp-fileupload")||d(this).data("fileupload"),s=(n.getFilesFromResponse||a.options.getFilesFromResponse)(n);n.context?n.context.each(function(e){var t=s[e]||{error:"Empty file upload result"};o=a._addFinishedDeferreds(),a._transition(d(this)).done(function(){var e=d(this);r=a._renderDownload([t]).replaceAll(e),a._forceReflow(r),a._transition(r).done(function(){n.context=d(this),a._trigger("completed",i,n),a._trigger("finished",i,n),o.resolve()})})}):(r=a._renderDownload(s)[a.options.prependFiles?"prependTo":"appendTo"](a.options.filesContainer),a._forceReflow(r),o=a._addFinishedDeferreds(),a._transition(r).done(function(){n.context=d(this),a._trigger("completed",i,n),a._trigger("finished",i,n),o.resolve()}))},fail:function(i,n){if(i.isDefaultPrevented())return!1;var r,o,a=d(this).data("blueimp-fileupload")||d(this).data("fileupload");n.context?n.context.each(function(e){var t;"abort"!==n.errorThrown?((t=n.files[e]).error=t.error||n.errorThrown||n.i18n("unknownError"),o=a._addFinishedDeferreds(),a._transition(d(this)).done(function(){var e=d(this);r=a._renderDownload([t]).replaceAll(e),a._forceReflow(r),a._transition(r).done(function(){n.context=d(this),a._trigger("failed",i,n),a._trigger("finished",i,n),o.resolve()})})):(o=a._addFinishedDeferreds(),a._transition(d(this)).done(function(){d(this).remove(),a._trigger("failed",i,n),a._trigger("finished",i,n),o.resolve()}))}):"abort"!==n.errorThrown?(n.context=a._renderUpload(n.files)[a.options.prependFiles?"prependTo":"appendTo"](a.options.filesContainer).data("data",n),a._forceReflow(n.context),o=a._addFinishedDeferreds(),a._transition(n.context).done(function(){n.context=d(this),a._trigger("failed",i,n),a._trigger("finished",i,n),o.resolve()})):(a._trigger("failed",i,n),a._trigger("finished",i,n),a._addFinishedDeferreds().resolve())},progress:function(e,t){if(e.isDefaultPrevented())return!1;var i=Math.floor(t.loaded/t.total*100);t.context&&t.context.each(function(){d(this).find(".progress").attr("aria-valuenow",i).children().first().css("width",i+"%")})},progressall:function(e,t){if(e.isDefaultPrevented())return!1;var i=d(this),n=Math.floor(t.loaded/t.total*100),r=i.find(".fileupload-progress"),o=r.find(".progress-extended");o.length&&o.html((i.data("blueimp-fileupload")||i.data("fileupload"))._renderExtendedProgress(t)),r.find(".progress").attr("aria-valuenow",n).children().first().css("width",n+"%")},start:function(e){if(e.isDefaultPrevented())return!1;var t=d(this).data("blueimp-fileupload")||d(this).data("fileupload");t._resetFinishedDeferreds(),t._transition(d(this).find(".fileupload-progress")).done(function(){t._trigger("started",e)})},stop:function(e){if(e.isDefaultPrevented())return!1;var t=d(this).data("blueimp-fileupload")||d(this).data("fileupload"),i=t._addFinishedDeferreds();d.when.apply(d,t._getFinishedDeferreds()).done(function(){t._trigger("stopped",e)}),t._transition(d(this).find(".fileupload-progress")).done(function(){d(this).find(".progress").attr("aria-valuenow","0").children().first().css("width","0%"),d(this).find(".progress-extended").html("&nbsp;"),i.resolve()})},processstart:function(e){if(e.isDefaultPrevented())return!1;d(this).addClass("fileupload-processing")},processstop:function(e){if(e.isDefaultPrevented())return!1;d(this).removeClass("fileupload-processing")},destroy:function(e,t){if(e.isDefaultPrevented())return!1;function i(){n._transition(t.context).done(function(){d(this).remove(),n._trigger("destroyed",e,t)})}var n=d(this).data("blueimp-fileupload")||d(this).data("fileupload");t.url?(t.dataType=t.dataType||n.options.dataType,d.ajax(t).done(i).fail(function(){n._trigger("destroyfailed",e,t)})):i()}},_resetFinishedDeferreds:function(){this._finishedUploads=[]},_addFinishedDeferreds:function(e){var t=e||d.Deferred();return this._finishedUploads.push(t),t},_getFinishedDeferreds:function(){return this._finishedUploads},_enableDragToDesktop:function(){var e=d(this),t=e.prop("href"),i=e.prop("download"),n="application/octet-stream";e.on("dragstart",function(e){try{e.originalEvent.dataTransfer.setData("DownloadURL",[n,i,t].join(":"))}catch(e){}})},_formatFileSize:function(e){return"number"!=typeof e?"":1e9<=e?(e/1e9).toFixed(2)+" GB":1e6<=e?(e/1e6).toFixed(2)+" MB":(e/1e3).toFixed(2)+" KB"},_formatBitrate:function(e){return"number"!=typeof e?"":1e9<=e?(e/1e9).toFixed(2)+" Gbit/s":1e6<=e?(e/1e6).toFixed(2)+" Mbit/s":1e3<=e?(e/1e3).toFixed(2)+" kbit/s":e.toFixed(2)+" bit/s"},_formatTime:function(e){var t=new Date(1e3*e),i=Math.floor(e/86400);return(i=i?i+"d ":"")+("0"+t.getUTCHours()).slice(-2)+":"+("0"+t.getUTCMinutes()).slice(-2)+":"+("0"+t.getUTCSeconds()).slice(-2)},_formatPercentage:function(e){return(100*e).toFixed(2)+" %"},_renderExtendedProgress:function(e){return this._formatBitrate(e.bitrate)+" | "+this._formatTime(8*(e.total-e.loaded)/e.bitrate)+" | "+this._formatPercentage(e.loaded/e.total)+" | "+this._formatFileSize(e.loaded)+" / "+this._formatFileSize(e.total)},_renderTemplate:function(e,t){if(!e)return d();var i=e({files:t,formatFileSize:this._formatFileSize,options:this.options});return i instanceof d?i:d(this.options.templatesContainer).html(i).children()},_renderPreviews:function(i){i.context.find(".preview").each(function(e,t){d(t).empty().append(i.files[e].preview)})},_renderUpload:function(e){return this._renderTemplate(this.options.uploadTemplate,e)},_renderDownload:function(e){return this._renderTemplate(this.options.downloadTemplate,e).find("a[download]").each(this._enableDragToDesktop).end()},_editHandler:function(e){var t,i,n,r,o;e.preventDefault(),this.options.edit&&(t=this,i=d(e.currentTarget),n=i.closest(".template-upload"),r=n.data("data"),o=i.data().index,this.options.edit(r.files[o]).then(function(e){e&&(r.files[o]=e,r.context.addClass("processing"),n.find(".edit,.start").prop("disabled",!0),d(t.element).fileupload("process",r).always(function(){n.find(".size").text(t._formatFileSize(r.files[o].size)),r.context.removeClass("processing"),t._renderPreviews(r)}).done(function(){n.find(".edit,.start").prop("disabled",!1)}).fail(function(){n.find(".edit").prop("disabled",!1);var e=r.files[o].error;e&&n.find(".error").text(e)}))}))},_startHandler:function(e){e.preventDefault();var t=d(e.currentTarget),i=t.closest(".template-upload").data("data");t.prop("disabled",!0),i&&i.submit&&i.submit()},_cancelHandler:function(e){e.preventDefault();var t=d(e.currentTarget).closest(".template-upload,.template-download"),i=t.data("data")||{};i.context=i.context||t,i.abort?i.abort():(i.errorThrown="abort",this._trigger("fail",e,i))},_deleteHandler:function(e){e.preventDefault();var t=d(e.currentTarget);this._trigger("destroy",e,d.extend({context:t.closest(".template-download"),type:"DELETE"},t.data()))},_forceReflow:function(e){return d.support.transition&&e.length&&e[0].offsetWidth},_transition:function(t){var i,n=d.Deferred();return d.support.transition&&t.hasClass("fade")&&t.is(":visible")?(i=function(e){e.target===t[0]&&(t.off(d.support.transition.end,i),n.resolveWith(t))},t.on(d.support.transition.end,i).toggleClass(this.options.showElementClass)):(t.toggleClass(this.options.showElementClass),n.resolveWith(t)),n},_initButtonBarEventHandlers:function(){var t=this.element.find(".fileupload-buttonbar"),i=this.options.filesContainer;this._on(t.find(".start"),{click:function(e){e.preventDefault(),i.find(".start").trigger("click")}}),this._on(t.find(".cancel"),{click:function(e){e.preventDefault(),i.find(".cancel").trigger("click")}}),this._on(t.find(".delete"),{click:function(e){e.preventDefault(),i.find(".toggle:checked").closest(".template-download").find(".delete").trigger("click"),t.find(".toggle").prop("checked",!1)}}),this._on(t.find(".toggle"),{change:function(e){i.find(".toggle").prop("checked",d(e.currentTarget).is(":checked"))}})},_destroyButtonBarEventHandlers:function(){this._off(this.element.find(".fileupload-buttonbar").find(".start, .cancel, .delete"),"click"),this._off(this.element.find(".fileupload-buttonbar .toggle"),"change.")},_initEventHandlers:function(){this._super(),this._on(this.options.filesContainer,{"click .edit":this._editHandler,"click .start":this._startHandler,"click .cancel":this._cancelHandler,"click .delete":this._deleteHandler}),this._initButtonBarEventHandlers()},_destroyEventHandlers:function(){this._destroyButtonBarEventHandlers(),this._off(this.options.filesContainer,"click"),this._super()},_enableFileInputButton:function(){this.element.find(".fileinput-button input").prop("disabled",!1).parent().removeClass("disabled")},_disableFileInputButton:function(){this.element.find(".fileinput-button input").prop("disabled",!0).parent().addClass("disabled")},_initTemplates:function(){var e=this.options;e.templatesContainer=this.document[0].createElement(e.filesContainer.prop("nodeName")),t&&(e.uploadTemplateId&&(e.uploadTemplate=t(e.uploadTemplateId)),e.downloadTemplateId&&(e.downloadTemplate=t(e.downloadTemplateId)))},_initFilesContainer:function(){var e=this.options;void 0===e.filesContainer?e.filesContainer=this.element.find(".files"):e.filesContainer instanceof d||(e.filesContainer=d(e.filesContainer))},_initSpecialOptions:function(){this._super(),this._initFilesContainer(),this._initTemplates()},_create:function(){this._super(),this._resetFinishedDeferreds(),d.support.fileInput||this._disableFileInputButton()},enable:function(){var e=!1;this.options.disabled&&(e=!0),this._super(),e&&(this.element.find("input, button").prop("disabled",!1),this._enableFileInputButton())},disable:function(){this.options.disabled||(this.element.find("input, button").prop("disabled",!0),this._disableFileInputButton()),this._super()}})});

